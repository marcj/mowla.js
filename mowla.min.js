/**
 * Mowla javascript template 'engine'.
 * 
 * Licensed under the shizzle dizzle MIT license.
 *
 * @author MArc Schmidt <https://github.com/MArcJ>
 */
(function(){var cache={};this.mowla={};this.mowla.length=function(pArObj){if(typeof(pArObj)=="array"){return pArObj.length}if("keys" in Object){return Object.keys(pArObj).length}else{var size=0;for(i in pArObj){if(pArObj.hasOwnProperty(i)){size++}}return size}};this.mowla.forEach=function(pArObj,pCb){var i=0;var length=mowla.length(pArObj);if(Object.prototype.toString.call(pArObj)!=="[object Array]"){for(i in pArObj){if(pArObj.hasOwnProperty(i)){pCb(pArObj[i],i==0,i==length-1,(i++)+1)}}}else{for(len=pArObj.length;i<len;i++){pCb(pArObj[i],i==0,i==length-1,i+1)}}};this.mowla.render=function(pSource,pData){pSource.innerHTML=mowla.fetch(pSource,pData)};this.mowla.compile=function(pSource){try{return new Function("data",code=mowla.getCode(pSource))}catch(e){console.log("[mowla.compile] error in following generated code");console.log(code);throw e}},this.mowla.escape=function(pValue){return typeof(pValue)=="string"?pValue.replace(/</g,"&lt;").replace(/>/g,"&gt;"):pValue};this.mowla.getCode=function(pSource){return"with(data){ _ = '"+pSource.replace(/\n/g,"'+\"\\n\"\n+'").replace(/([^\\])\{\/(if|for|while)\}/g,"$1'; \\} _ += '").replace(/([^\\])\{else\}/g,"$1'; \\} else \\{ _ += '").replace(/([^\\])\{\/foreach\}/g,"$1'; \\}); _ += '").replace(/([^\\])\{foreach ([^\}]*) as ([^\}]*)\}/g,"$1'; mowla.forEach($2, function($3, first, last, index)\\{ _ += '").replace(/([^\\])\{call ([^\}\\]*(?:\\.[^}\\]*)*)\}/g,"$1'; $2; _ += '").replace(/([^\\])\{html ([^\}\\]*(?:\\.[^}\\]*)*)\}/g,"$1'; _ += ($2); _ += '").replace(/([^\\])\{(if|for|while) ([^}]*)\}/g,"$1'; $2 ($3) \\{ _ += '").replace(/([^\\])\{var ([^}]*)\}/g,"$1'; ($2); _ += '").replace(/([^\\]){/g,"$1'; _ += mowla.escape(").replace(/([^\\])}/g,"$1); _ += '").replace(/\\{/g,"{").replace(/\\}/g,"}")+"'; return _;}"};this.mowla.htmlEntities=function(pHtml){return pHtml.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")};this.mowla.fetch=function(pSource,pData){if(!pData){pData=window}if(typeof(pSource)=="object"&&"innerHTML" in pSource){return mowla.fetch(mowla.htmlEntities(pSource.innerHTML),pData)}return(cache[pSource]||(cache[pSource]=mowla.compile(pSource)))(pData)}})();